2003-02-25  Kaz Sasayama  <kaz2003@hypercore.co.jp>

	* Version 2.0.4.

	* configure.ac: Update PACKAGE_VERSION.
	* configure: Regenerated.

	* npaudio.bpr (FileDescription): Updated.
	(FileVersion): Updated.

	* NEWS: Updated.

	* audio.cpp (NPP_NewStream) [!_WIN32]: Use the nothrow version of
	new.

	* Makefile.am (libaudioplugin_la_SOURCES): Add the new file.
	* Makefile.in: Regenerated.

	* new.cpp: New file.

2003-02-24  Kaz Sasayama  <kaz2003@hypercore.co.jp>

	* audio.cpp (struct audio_data): Add new member: loop.
	(struct audio_data) [!_WIN32]: Replace members child and
	file_format with player.
	(stop) [!_WIN32]: Stop and delete data->player.
	(NPP_New): Handle parameter "loop".
	(NPP_New) [!_WIN32]: Change the member initialization.
	(NPP_NewStream) [_WIN32]: Use NP_ASFILEONLY.
	(NPP_NewStream) [!_WIN32]: Instantiate and set up a media player.
	(NPP_DestroyStream) [!_WIN32]: Start playback if the stream is
	successfully finished.
	(NPP_WriteReady, NPP_Write): Remove the debug message.
	(NPP_WriteReady) [!_WIN32]: Return the player's buffer size.
	(NPP_Write) [!_WIN32]: Write data to the player.
	(NPP_StreamAsFile) [!_WIN32]: Remove the code.

	* Makefile.am (libaudioplugin_la_SOURCES): Add the new files:
	sox_media_player.cpp, exec_media_player.cpp,
	file_media_player.cpp, and media_player.cpp.
	(noinst_HEADERS): Add the new files: exec_media_player.h
	media_player.h.
	* Makefile.in: Regenerated.

2003-02-23  Kaz Sasayama  <kaz2003@hypercore.co.jp>

	* media_player.h: New file.
	* media_player.cpp: New file.
	* file_media_player.cpp: New file.
	* exec_media_player.h: New file.
	* exec_media_player.cpp: New file.
	* sox_media_player.cpp: New file.

	* audio.cpp (NPP_StreamAsFile): Reformat the code.

	* audio.cpp: Add #include <npapi.h>.

	* common.h: Remove #include <npapi.h>.

	* audio.cpp: Use the C++ headers if available.

	* common.h [_WIN32] (STDC_HEADERS, HAVE_FCNTL_H): Defined to 1.

	* audio.cpp: Modify the head comment.  Define _REENTRANT.
	(NPP_GetValue) [XP_UNIX]: Use PACKAGE_NAME for the plugin name.
	(NPP_New): Add comment.
	* common.h: Modify the head comment.
	* java/jri.h: Modify the head comment.

	* npaudio.bpr: Modify the include path.  Clean up histories.

	* audio.cpp (stop) [_WIN32]: Release the filter graph.
	(NPP_New) [_WIN32]: Do not create a filter graph here.
	(NPP_Destroy): Do not release the filter graph here.
	(NPP_StreamAsFile) [_WIN32]: Create a new filter graph.

	* NEWS: Updated.

	* audio.cpp (struct audio_data) [!_WIN32]: Move member file_format
	from audio_stream_data.
	(struct audio_stream_data): Removed.
	(NPP_NewStream): Remove allocation of the stream private data.
	(NPP_NewStream) [!_WIN32]: Use data->file_format.
	(NPP_DestroyStream): Remove deallocation of the stream private data.
	(NPP_StreamAsFile) [!_WIN32]: Use data->file_format.
	(NPP_StreamAsFile) [!_WIN32]: Avoid STDIN_FILENO and STDOUT_FILENO.
	(NPP_StreamAsFile) [!_WIN32]: Rename variable null to null_device.
	(NPP_StreamAsFile) [!_WIN32]: Call setsid.
	(stop) [!_WIN32]: Kill the child process group.

	* configure.ac: Update the directory names.
	* configure: Regenerated.

	* Makefile.am (INCLUDES): Update the directory names.
	(SUBDIRS): Update the directory name.
	* Makefile.in: Regenerated.
	* nspr/Makefile.in: Regenerated.
	* nspr/obsolete/Makefile.in: Regenerated.

	* Rename directory mozilla to nspr.

2003-02-22  Kaz Sasayama  <kaz2003@hypercore.co.jp>

	* configure.ac: Add the new Makefiles to AC_CONFIG_FILES.
	* configure: Regenerated.

	* Makefile.am (INCLUDES): Add the new directories to the include
	path.
	(SUBDIRS): Add the new directories.
	* Makefile.in: Regenerated.

	* mozilla/Makefile.am (noinst_HEADERS): Delete npapi.h, npupp.h,
	and jri.h.
	* mozilla/Makefile.in: Regenerated.

	* xpcom/Makefile.am: New file.
	* xpcom/Makefile.in: Generated.

	* java/Makefile.am: New file.
	* java/Makefile.in: Generated.

	* java/jri.h: Moved from mozilla.

	* plugin/Makefile.am: New file.
	* plugin/Makefile.in: Generated.

	* plugin/npapi.h: Moved from mozilla.
	* plugin/npupp.h: Moved from mozilla.

	* midi.cpp: Removed.

	* Makefile.am (plugins_LTLIBRARIES): Remove libmidiplugin.la.
	(libmidiplugin_la_LDFLAGS, libmidiplugin_la_SOURCES): Removed.
	* Makefile.in: Regenerated.

	* audio.cpp (struct audio_stream_data): New struct.
	(NPP_GetMIMEDescription): Add MIDI sequence types.
	(NPP_New): Set to the windowless mode.
	(NPP_NewStream): Store an audio_stream_data as the stream private
	data.
	(NPP_DestroyStream): Correct an argument type.
	(NPP_DestroyStream): Stop playback if reason != NPRES_DONE.
	(NPP_DestroyStream): Deallocate the stream private data.
	(NPP_StreamAsFile): Handle MIDI type.

	* midi.cpp: Updated as audio.cpp.

	* audio.cpp (struct audio_data) [!_WIN32]: Remove member: format.
	(NPP_Initialize, NPP_Shutdown, NPP_GetMIMEDescription,
	NPP_GetValue, NPP_SetValue): Add function comments.
	(NPP_Initialize, NPP_Shutdown): Remove fprintf for debugging.
	(NPP_Initialize) [_WIN32]: Check the result of CoInitialize.
	(NPP_GetValue): Omit debug messages if instance is null.
	(NPP_GetValue, NPP_SetValue, NPP_New, NPP_Destroy, NPP_Print,
	NPP_SetWindow, NPP_HandleEvent, NPP_NewStream, NPP_DestroyStream,
	NPP_WriteReady, NPP_Write, NPP_StreamAsFile, NPP_URLNotify):
	Modify debug messages.
	(NPP_NewStream) [!_WIN32]: Store format in stream->pdata.
	(NPP_StreamAsFile) [!_WIN32]: Use format in stream->pdata.

	* Makefile.am (INCLUDES): Modify the include path.
	* Makefile.in: Regenerated.

2003-02-21  Kaz Sasayama  <kaz2003@hypercore.co.jp>

	* Version 2.0.3.

	* configure.ac: Update PACKAGE_VERSION.
	* configure: Regenerated.

	* npaudio.bpr (FileDescription): Update version numbers.

	* NEWS: Updated.

	* mozilla/npupp.h: Add prototype for NP_GetValue.

2003-02-20  Kaz Sasayama  <kaz2003@hypercore.co.jp>

	* audio.cpp (stop): Define also if _WIN32.
	(stop) [_WIN32]: Stop playback.
	(NPP_New): Initialize audio_data members explicitly.
	(NPP_Destroy, NPP_NewStream): Use stop also if _WIN32.

	* configure.ac: Create link mozilla/prcpucfg.h according to the
	host operating system.
	* configure: Regenerated.

	* mozilla/Makefile.am (noinst_HEADERS): Remove prcpucfg.h.  Add
	the new files.
	(distclean-local): New target.
	* mozilla/Makefile.in: Regenerated.

	* mozilla/_linux.cfg: Renamed from prcpucfg.h.
	* mozilla/_win95.cfg: New file.

	* Makefile.am (INCLUDES): Add -Imozilla
	* Makefile.in: Regenerated.

	* audio.cpp (struct audio_data) [_WIN32]: Add new member graph.
	[_WIN32]: Remove static vaiables.
	(NPP_New, NPP_Destroy, NPP_NewStream, NPP_StreamAsFile) [_WIN32]:
	Use the new struct member instead of the removed static variables.

	* Makefile.am (EXTRA_DIST): Add the new files.
	* Makefile: Regenerated.

	* npaudio.bpr: New file.
	* npaudio.bpf: New file.
	* npaudio.res: New file.
	* npaudio.def: New file.

	* NEWS: Add new entry for version 2.0.3.

	* audio.cpp (struct audio_data): New struct.
	[!_WIN32]: Remove static variables.
	[!_WIN32] (stop): Add new argument data.  Also change all callers.
	[!_WIN32] (stop): Use the struct member instead of the removed
	static variables.
	(NPP_New): Allocate the private data.
	(NPP_Destroy): Deallocate the private data.
	(NPP_NewStream, NPP_StreamAsFile) [!_WIN32]: Use the struct member
	instead of the removed static variables.
	(NPP_NewStream) [!_WIN32]: Check for audio/wav too.

	* audio.cpp [_WIN32]: Include <dshow.h>.
	(NPP_Initialize) [_WIN32]: Call CoInitialize.
	(NPP_Shutdown) [_WIN32]: Call CoUninitialize.
	[_WIN32]: Add new static variables: graph & control.
	(NPP_New) [_WIN32]: Initialize static variables.
	(NPP_Destroy) [_WIN32]: Clean up static variables.
	(NPP_NewStream) [_WIN32]: Stop playback.
	(NPP_StreamAsFile) [_WIN32]: Start playback of the file.

	* mozilla/npapi.h: Revert to test _WINDOWS for Windows platforms.

	* mozilla/jri.h [_WINDOWS]: Include <windows.h>.

2003-02-16  Kaz Sasayama  <kaz2003@hypercore.co.jp>

	* configure.ac: Change the bug reporting address.
	* configure: Regenerated.

	* Version 2.0.2.

	* configure.ac: Change PACKAGE_VERSION.  Change the test file for
	the source directory.
	* configure: Regenerated.

	* NEWS: Updated.

	* README: Updated.

	* Makefile.am (libaudioplugin_la_SOURCES): Change the file suffix.
	(libmidiplugin_la_SOURCES): Likewise.
	* Makefile.in: Regenerated.

	* np_entry.cpp: Renamed from np_entry.c.
	* npn_gate.cpp: Renamed from npn_gate.c.

	* audio.cpp [_WIN32] (DllMain): New function.

	* midi.cpp [_WIN32] (DllMain): New function.

2003-02-15  Kaz Sasayama  <kaz2003@hypercore.co.jp>

	* mozilla/Makefile.in: Regenerated.
	* mozilla/obsolete/Makefile.in: Regenerated.

	* Makefile.am (libaudioplugin_la_SOURCES): Change the file suffix.
	(libmidiplugin_la_SOURCES): Likewise.
	* Makefile.in: Regenerated.

	* audio.cpp: Renamed from audio.c.
	* midi.cpp: Renamed from midi.c.

	* configure.ac: Add AC_PROG_CXX.
	* configure: Regenerated.

	* np_entry.c [XP_WIN] (NP_Initialize): Use NPP_Initialize.
	[XP_MAC] (Private_Initialize): Use NPP_Initialize.
	[XP_MAC] (Private_Shutdown): Use NPP_Shutdown.

	* midi_mime.h: Removed.

	* Makefile.am (libmidiplugin_la_SOURCES): Delete midi_mime.c.
	* Makefile.in: Regenerated.

	* midi.c [XP_UNIX] (NPP_GetMIMEDescription): Moved from
	midi_mime.c.
	(NPP_GetValue): Handle NPPVpluginNameString and
	NPPVpluginDescriptionString only if XP_UNIX.
	(NPP_SetValue): Fix the type of variable.
	(stop): Hide if _WIN32.
	(NPP_Destroy): Do not call if _WIN32.
	(NPP_NewStream): Likewise.
	(NPP_StreamAsFile): Hide code if _WIN32.

	* mozilla/npapi.h: Test _WIN32 instead of _WINDOWS.

	* audio_mime.c: Removed.

	* Makefile.am (libaudioplugin_la_SOURCES): Delete audio_mime.c.
	* Makefile.in: Regenerated.

	* audio.c (NPP_GetValue): Handle NPPVpluginNameString and
	NPPVpluginDescriptionString only if XP_UNIX.
	(NPP_SetValue): Fix the type of variable.
	(stop): Hide if _WIN32.
	(NPP_Destroy): Do not call stop if _WIN32.
	(NPP_NewStream): Likewise and also do not set format.
	(NPP_StreamAsFile): Hide code if _WIN32.
	[XP_UNIX] (NPP_GetMIMEDescription): Moved from audio_mime.c.

2003-02-13  Kaz Sasayama  <kaz2003@hypercore.co.jp>

	* Makefile.am (INCLUDES): Remove -DXP_UNIX.
	* Makefile: Regenerated.

	* audio.c: Remove the inclusion of <unistd.h>.
	* midi.c: Likewise.

	* common.h [HAVE_UNISTD_H]: Include <unistd.h>.
	[_WIN32]: Include <windows.h>.

	* audio.c: Move the _GNU_SOURCE definition to the beginning.
	* audio_mime.c: Likewise.
	* midi.c: Likewise.
	* midi_mime.c: Likewise.

	* NEWS: Updated.

	* AUTHORS: Updated.

	* README: Updated.

2003-02-12  Kaz Sasayama  <kaz2003@hypercore.co.jp>

	* mozilla/npupp.h (struct _NPPluginFuncs): #if out javaClass.
	* np_entry.c (fillPluginFunctionTable): #if out the javaClass
	initialization.

	* audio_mime.c (NPP_GetMIMEDescription): Remove extensions for
	audio/wav.
	* midi_mime.c (NPP_GetMIMEDescription): Remove extensions for
	audio/midi.

	* audio.c (NPP_StreamAsFile): Avoid EXIT_FAILURE.
	* midi.c (NPP_StreamAsFile): Likewise.

	* mozilla/Makefile.am (noinst_HEADERS): Delete removed files.
	* mozilla/Makefile.in: Rebuilt.

	* mozilla/jritypes.h: Removed.
	* mozilla/jri_md.h: Removed.
	* mozilla/jni.h: Removed.
	* mozilla/jni_md.h: Removed.

	* mozilla/jri.h: Replaced with a dummy header.

	* Version 2.0.1.

	* configure.ac: Update PACKAGE_VERSION.

2003-02-11  Kaz Sasayama  <kaz2003@hypercore.co.jp>

	* Begin hacking.

